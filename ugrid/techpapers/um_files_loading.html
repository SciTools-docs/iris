

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Iris handling of PP and Fieldsfiles &mdash; Iris 3.0.0ugrid1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Missing data handling in Iris" href="missing_data_handling.html" />
    <link rel="prev" title="Iris technical papers" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/iris-logo-title.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing Iris</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generated/gallery/index.html">Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userguide/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/iris_cubes.html">Iris data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/loading_iris_cubes.html">Loading Iris cubes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/saving_iris_cubes.html">Saving Iris cubes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/navigating_a_cube.html">Navigating a cube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/subsetting_a_cube.html">Subsetting a cube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/real_and_lazy_data.html">Real and lazy data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/plotting_a_cube.html">Plotting a cube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/interpolation_and_regridding.html">Cube interpolation and regridding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/merge_and_concat.html">Merge and concatenate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/cube_statistics.html">Cube statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/cube_maths.html">Cube maths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/citation.html">Citing Iris</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/code_maintenance.html">Code maintenance</a></li>
</ul>
<p class="caption"><span class="caption-text">Further Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../further_topics/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../further_topics/metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../further_topics/lenient_metadata.html">Lenient metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../further_topics/lenient_maths.html">Lenient cube maths</a></li>
</ul>
<p class="caption"><span class="caption-text">Developers Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/contributing_getting_involved.html">Getting involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/gitwash/index.html">Working with Iris source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/contributing_documentation.html">Contributing to the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/contributing_codebase_index.html">Contributing to the code base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/contributing_changes.html">Contributing your changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/release.html">Releases</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../generated/api/iris.html">Iris API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">What’s new in Iris</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Iris technical papers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Iris handling of PP and Fieldsfiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview-of-loading-process">Overview of loading process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#horizontal-grid">Horizontal Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phenomenon-identification">Phenomenon identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vertical-coordinates">Vertical coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-information">Time information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistical-measures">Statistical measures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-metadata">Other metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lbrsvd4">LBRSVD4</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lbuser5">LBUSER5</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="missing_data_handling.html">Missing data handling in Iris</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">Iris copyright, licensing and contributors</a></li>
</ul>

            
          

    
    
    
        <p class="caption">
            <span class="caption-text">
            
                Support
            
            </span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://github.com/SciTools/iris"><i class="fa fa-github fa-fw"></i> Source code</a></li>
            
                <li class="toctree-l1"><a href="https://groups.google.com/forum/#!forum/scitools-iris"><i class="fa fa-comments fa-fw"></i> Users Google Group</a></li>
            
                <li class="toctree-l1"><a href="https://groups.google.com/forum/#!forum/scitools-iris-dev"><i class="fa fa-comments fa-fw"></i> Developers Google Group</a></li>
            
                <li class="toctree-l1"><a href="https://stackoverflow.com/questions/tagged/python-iris"><i class="fa fa-question fa-fw"></i> StackOverflow for "How do I?"</a></li>
            
                <li class="toctree-l1"><a href="https://scitools.org.uk/iris/docs/v2.4.0/index.html"><i class="fa fa-book fa-fw"></i> Legacy documentation</a></li>
            
        </ul>
    

        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Iris</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Iris technical papers</a> &raquo;</li>
        
      <li>Iris handling of PP and Fieldsfiles</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/techpapers/um_files_loading.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="um-files-loading"></span><div class="section" id="iris-handling-of-pp-and-fieldsfiles">
<h1>Iris handling of PP and Fieldsfiles<a class="headerlink" href="#iris-handling-of-pp-and-fieldsfiles" title="Permalink to this headline">¶</a></h1>
<p>This document provides a basic account of how PP and Fieldsfiles data is
represented within Iris.
It describes how Iris represents data from the Met Office Unified Model (UM),
in terms of the metadata elements found in PP and Fieldsfile formats.</p>
<p>For simplicity, we shall describe this mostly in terms of <em>loading of PP data into
Iris</em> (i.e. into cubes).  However most of the details are identical for
Fieldsfiles, and are relevant to saving in these formats as well as loading.</p>
<p>Notes:</p>
<ol class="arabic simple">
<li><p>Iris treats Fieldsfile data almost exactly as if it were PP  – i.e. it
treats each field’s lookup table entry like a PP header.</p></li>
<li><p>The Iris data model is based on
<a class="reference external" href="http://cfconventions.org/">NetCDF CF conventions</a>, so most of this can
also be seen as a metadata translation between PP and CF terms, but it is
easier to discuss in terms of Iris elements.</p></li>
</ol>
<p>For details of Iris terms (cubes, coordinates, attributes), refer to
<a class="reference internal" href="../userguide/iris_cubes.html#iris-data-structures"><span class="std std-ref">Iris data structures</span></a>.</p>
<p>For details of CF conventions, see <a class="reference external" href="http://cfconventions.org/">http://cfconventions.org/</a>.</p>
<div class="section" id="overview-of-loading-process">
<h2>Overview of loading process<a class="headerlink" href="#overview-of-loading-process" title="Permalink to this headline">¶</a></h2>
<p>The basics of Iris loading are explained at <a class="reference internal" href="../userguide/loading_iris_cubes.html#loading-iris-cubes"><span class="std std-ref">Loading Iris cubes</span></a>.
Loading as it specifically applies to PP and Fieldsfile data can be summarised
as follows:</p>
<ol class="arabic simple">
<li><p>Input fields are first loaded from the given sources, using
<a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.load" title="iris.fileformats.pp.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.pp.load()</span></code></a>.  This returns an iterator, which provides
a ‘stream’ of <a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.PPField" title="iris.fileformats.pp.PPField"><code class="xref py py-class docutils literal notranslate"><span class="pre">PPField</span></code></a> input field objects.
Each PPfield object represents a single source field:</p>
<ul class="simple">
<li><p>PP header elements are provided as named object attributes (e.g.
<a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.PPField.lbproc" title="iris.fileformats.pp.PPField.lbproc"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lbproc</span></code></a>).</p></li>
<li><p>Some extra, calculated “convenience” properties are also provided (e.g.
<a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.PPField.t1" title="iris.fileformats.pp.PPField.t1"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t1</span></code></a> and
<a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.PPField.t2" title="iris.fileformats.pp.PPField.t2"><code class="xref py py-attr docutils literal notranslate"><span class="pre">t2</span></code></a> time values).</p></li>
<li><p>There is a <a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.PPField.data" title="iris.fileformats.pp.PPField.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iris.fileformats.pp.PPField.data</span></code></a> attribute, but the
field data is not actually loaded unless/until this is accessed, for
greater speed and space efficiency.</p></li>
</ul>
</li>
<li><p>Each input field is translated into a two-dimensional Iris cube (with
dimensions of latitude and longitude).  These are the ‘raw’ cubes, as
returned by <a class="reference internal" href="../generated/api/iris.html#iris.load_raw" title="iris.load_raw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iris.load_raw()</span></code></a>.
Within these:</p>
<ul class="simple">
<li><p>There are 2 horizontal dimension coordinates containing the latitude
and longitude values for the field.</p></li>
<li><p>Certain other header elements are interpreted as ‘coordinate’-type
values applying to the input fields, and  stored as auxiliary ‘scalar’
(i.e. 1-D) coordinates.  These include all header elements defining
vertical and time coordinate values, and also more specialised factors
such as ensemble number and pseudo-level.</p></li>
<li><p>Other metadata is encoded on the cube in a variety of other forms, such
as the cube ‘name’ and ‘units’ properties, attribute values and cell
methods.</p></li>
</ul>
</li>
<li><p>Lastly, Iris attempts to merge the raw cubes into higher-dimensional ones
(using <a class="reference internal" href="../generated/api/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a>):  This combines raw cubes with
different values of a scalar coordinate to produce a higher-dimensional
cube with the values contained in a new vector coordinate.  Where possible,
the new vector coordinate is also a <em>dimension</em> coordinate, describing the
new dimension.
Apart from the original 2 horizontal dimensions, all cube dimensions and
dimension coordinates arise in this way – for example, ‘time’, ‘height’,
‘forecast_period’, ‘realization’.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document covers the essential features of the UM data loading process.
The complete details are implemented as follows:</p>
<ul class="simple">
<li><p>The conversion of fields to raw cubes is performed by the function
<code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.pp_rules.convert()</span></code>, which is called from
<a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.load_cubes" title="iris.fileformats.pp.load_cubes"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.pp.load_cubes()</span></code></a> during loading.</p></li>
<li><p>The corresponding save functionality for PP output is implemented by
the <a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.save" title="iris.fileformats.pp.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.pp.save()</span></code></a> function.  The relevant
‘save rules’ are defined in a text file
(“lib/iris/etc/pp_save_rules.txt”), in a form defined by the
<a class="reference internal" href="../generated/api/iris/fileformats/rules.html#module-iris.fileformats.rules" title="iris.fileformats.rules"><code class="xref py py-mod docutils literal notranslate"><span class="pre">iris.fileformats.rules</span></code></a> module.</p></li>
</ul>
</div>
<p>The rest of this document describes various independent sections of related
metadata items.</p>
</div>
<div class="section" id="horizontal-grid">
<h2>Horizontal Grid<a class="headerlink" href="#horizontal-grid" title="Permalink to this headline">¶</a></h2>
<dl>
<dt><strong>UM Field elements</strong></dt><dd><p>LBCODE, BPLAT, BPLON, BZX, BZY, BDX, BDY, X, Y,
X_LOWER_BOUNDS, Y_LOWER_BOUNDS</p>
</dd>
<dt><strong>Cube components</strong></dt><dd><p>(unrotated) : coordinates <code class="docutils literal notranslate"><span class="pre">longitude</span></code>, <code class="docutils literal notranslate"><span class="pre">latitude</span></code></p>
<p>(rotated pole) : coordinates <code class="docutils literal notranslate"><span class="pre">grid_latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">grid_longitude</span></code></p>
</dd>
</dl>
<p><strong>Details</strong></p>
<p>At present, only latitude-longitude projections are supported (both normal and
rotated).
In these cases, LBCODE is typically 1 or 101 (though, in fact, cross-sections
with latitude and longitude axes are also supported).</p>
<p>For an ordinary latitude-longitude grid, the cubes have coordinates called
‘longitude’ and ‘latitude’:</p>
<blockquote>
<div><ul class="simple">
<li><p>These are mapped to the appropriate data dimensions.</p></li>
<li><p>They have units of ‘degrees’.</p></li>
<li><p>They have a coordinate system of type <a class="reference internal" href="../generated/api/iris/coord_systems.html#iris.coord_systems.GeogCS" title="iris.coord_systems.GeogCS"><code class="xref py py-class docutils literal notranslate"><span class="pre">iris.coord_systems.GeogCS</span></code></a>.</p></li>
<li><p>The coordinate points are normally set to the regular sequence
<code class="docutils literal notranslate"><span class="pre">ZDX/Y</span> <span class="pre">+</span> <span class="pre">BDX/Y</span> <span class="pre">*</span> <span class="pre">(1</span> <span class="pre">..</span> <span class="pre">LBNPT/LBROW)</span></code> (<em>except</em>, if BDX/BDY is zero, the
values are taken from the extra data vector X/Y, if present).</p></li>
<li><p>If X/Y_LOWER_BOUNDS extra data is available, this appears as bounds values
of the horizontal coordinates.</p></li>
</ul>
</div></blockquote>
<p>For <strong>rotated</strong> latitude-longitude coordinates (as for LBCODE=101), the
horizontal coordinates differ only slightly –</p>
<blockquote>
<div><ul class="simple">
<li><p>The names are ‘grid_latitude’ and ‘grid_longitude’.</p></li>
<li><p>The coord_system is a <a class="reference internal" href="../generated/api/iris/coord_systems.html#iris.coord_systems.RotatedGeogCS" title="iris.coord_systems.RotatedGeogCS"><code class="xref py py-class docutils literal notranslate"><span class="pre">iris.coord_systems.RotatedGeogCS</span></code></a>, created
with a pole defined by BPLAT, BPLON.</p></li>
</ul>
</div></blockquote>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load a PP field.</span>
<span class="gp">... </span><span class="n">fname</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;air_temp.pp&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fields_iter</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">field</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">fields_iter</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show grid details and first 5 longitude values.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">lbcode</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">lbnpt</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">bzx</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">field</span><span class="o">.</span><span class="n">bdx</span><span class="p">)))</span>
<span class="go">1 96 -3.749999 3.749999</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">bzx</span> <span class="o">+</span> <span class="n">field</span><span class="o">.</span><span class="n">bdx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="go">[ 0.    3.75  7.5  11.25 15.  ]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show Iris equivalent information.</span>
<span class="gp">... </span><span class="n">cube</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">load_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">points</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="go">[ 0.    3.75  7.5  11.25 15.  ]</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that in Iris (as in CF) there is no special distinction between
“regular” and “irregular” coordinates.  Thus on saving, X and Y extra data
sections are written only if the actual values are unevenly spaced.</p>
</div>
</div>
<div class="section" id="phenomenon-identification">
<h2>Phenomenon identification<a class="headerlink" href="#phenomenon-identification" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><strong>UM Field elements</strong></dt><dd><p>LBFC, LBUSER4 (aka “stashcode”), LBUSER7 (aka “model code”)</p>
</dd>
<dt><strong>Cube components</strong></dt><dd><p><code class="docutils literal notranslate"><span class="pre">cube.standard_name</span></code>, <code class="docutils literal notranslate"><span class="pre">cube.units</span></code>, <code class="docutils literal notranslate"><span class="pre">cube.attributes['STASH']</span></code></p>
</dd>
</dl>
<p><strong>Details</strong></p>
<p>This information is normally encoded in the cube <code class="docutils literal notranslate"><span class="pre">standard_name</span></code> property.
Iris identifies the stash section and item codes from LBUSER4 and the model
code in LBUSER7, and compares these against a list of phenomenon types with
known CF translations.  If the stashcode is recognised, it then defines the
appropriate <code class="docutils literal notranslate"><span class="pre">standard_name</span></code> and <code class="docutils literal notranslate"><span class="pre">units</span></code> properties of the cube
(i.e. <a class="reference internal" href="../generated/api/iris/cube.html#iris.cube.Cube.standard_name" title="iris.cube.Cube.standard_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iris.cube.Cube.standard_name</span></code></a> and <a class="reference internal" href="../generated/api/iris/cube.html#iris.cube.Cube.units" title="iris.cube.Cube.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">iris.cube.Cube.units</span></code></a>).</p>
<p>Where any parts of the stash information are outside the valid range, Iris will
instead attempt to interpret LBFC, for which a set of known translations is
also stored.  This is often the case for fieldsfiles, where LBUSER4 is
frequently left as 0.</p>
<p>In all cases, Iris also constructs a <a class="reference internal" href="../generated/api/iris/fileformats/pp.html#iris.fileformats.pp.STASH" title="iris.fileformats.pp.STASH"><code class="xref py py-class docutils literal notranslate"><span class="pre">STASH</span></code></a> item
to identify the phenomenon, which is stored as a cube attribute named
<code class="docutils literal notranslate"><span class="pre">STASH</span></code>.
This preserves the original STASH coding (as standard name translation is not
always one-to-one), and can be used when no standard_name translation is
identified (for example, to load only certain stashcodes with a constraint
– see example at <a class="reference internal" href="../generated/api/iris.html#constraint-egs"><span class="std std-ref">Load constraint examples</span></a>).</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show PPfield phenomenon details.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">lbuser</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="go">16203</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">lbuser</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="go">1</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show Iris equivalents.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">standard_name</span><span class="p">)</span>
<span class="go">air_temperature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;STASH&#39;</span><span class="p">])</span>
<span class="go">m01s16i203</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On saving data, no attempt is made to translate a cube standard_name into a
STASH code, but any attached ‘STASH’ attribute will be stored into the
LBUSER4 and LBUSER7 elements.</p>
</div>
</div>
<div class="section" id="vertical-coordinates">
<h2>Vertical coordinates<a class="headerlink" href="#vertical-coordinates" title="Permalink to this headline">¶</a></h2>
<dl>
<dt><strong>UM Field elements</strong></dt><dd><p>LBVC, LBLEV, BRSVD1 (aka “bulev”), BRSVD2 (aka “bhulev”), BLEV, BRLEV,
BHLEV, BHRLEV</p>
</dd>
<dt><strong>Cube components</strong></dt><dd><p>for height levels : coordinate <code class="docutils literal notranslate"><span class="pre">height</span></code></p>
<p>for pressure levels : coordinate <code class="docutils literal notranslate"><span class="pre">pressure</span></code></p>
<p>for hybrid height levels :</p>
<ul class="simple">
<li><p>coordinates <code class="docutils literal notranslate"><span class="pre">model_level_number</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">level_height</span></code>,
<code class="docutils literal notranslate"><span class="pre">altitude</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cube.aux_factories()[0].orography</span></code></p></li>
</ul>
<p>for hybrid pressure levels :</p>
<ul class="simple">
<li><p>coordinates <code class="docutils literal notranslate"><span class="pre">model_level_number</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">level_pressure</span></code>,
<code class="docutils literal notranslate"><span class="pre">air_pressure</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cube.aux_factories()[0].surface_air_pressure</span></code></p></li>
</ul>
</dd>
</dl>
<p><strong>Details</strong></p>
<p>Several vertical coordinate forms are supported, according to different values
of LBVC.  The commonest ones are:</p>
<ul class="simple">
<li><p>lbvc=1 : height levels</p></li>
<li><p>lbvc=8 : pressure levels</p></li>
<li><p>lbvc=65 : hybrid height</p></li>
</ul>
<p>In all these cases, vertical coordinates are created, with points and bounds
values taken from the appropriate header elements.  In the raw cubes, each
vertical coordinate is just a single value, but multiple values will usually
occur.  The subsequent merge operation will then convert these into
multiple-valued coordinates, and create a new vertical data dimension (i.e. a
“Z” axis) which they map onto.</p>
<dl>
<dt>For height levels (LBVC=1):</dt><dd><p>A <code class="docutils literal notranslate"><span class="pre">height</span></code> coordinate is created.  This has units ‘m’, points from
BLEV, and no bounds.  When there are multiple vertical levels, this will
become a dimension coordinate mapping to the vertical dimension.</p>
</dd>
<dt>For pressure levels (LBVC=8):</dt><dd><p>A <code class="docutils literal notranslate"><span class="pre">pressure</span></code> coordinate is created.  This has units ‘hPa’, points from
BLEV, and no bounds.  When there are multiple vertical levels, this will
become a dimension coordinate mapping a vertical dimension.</p>
</dd>
<dt>For hybrid height levels (LBVC=65):</dt><dd><p>Three basic vertical coordinates are created:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_level</span></code> is dimensionless, with points from LBLEV and no bounds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigma</span></code> is dimensionless, with points from BHLEV and bounds from
BHRLEV and BHULEV.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level_height</span></code> has units of ‘m’, points from BLEV and bounds from
BRLEV and BULEV.</p></li>
</ul>
<p>Also in this case, a <a class="reference internal" href="../generated/api/iris/aux_factory.html#iris.aux_factory.HybridHeightFactory" title="iris.aux_factory.HybridHeightFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">HybridHeightFactory</span></code></a> is
created, which references the ‘level_height’ and ‘sigma’ coordinates.
Following raw cube merging, an extra load stage occurs where the
attached <a class="reference internal" href="../generated/api/iris/aux_factory.html#iris.aux_factory.HybridHeightFactory" title="iris.aux_factory.HybridHeightFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">HybridHeightFactory</span></code></a> is called to
manufacture a new <code class="docutils literal notranslate"><span class="pre">altitude</span></code> coordinate:</p>
<ul class="simple">
<li><p>The altitude coordinate is 3D, mapping to the 2 horizontal
dimensions <em>and</em> the new vertical dimension.</p></li>
<li><p>Its units are ‘m’.</p></li>
<li><p>Its points are calculated from those of the ‘level_height’ and
‘sigma’ coordinates, and an orography field.  If ‘sigma’ and
‘level_height’ possess bounds, then bounds are also created for
‘altitude’.</p></li>
</ul>
<p>To make the altitude coordinate, there must be an orography field present
in the load sources.  This is a surface altitude reference field,
identified (by stashcode) during the main loading operation, and recorded
for later use in the hybrid height calculation.  If it is absent, a warning
message is printed, and no altitude coordinate is produced.</p>
<p>Note that on merging hybrid height data into a cube, only the ‘model_level’
coordinate becomes a dimension coordinate:  The other vertical coordinates
remain as auxiliary coordinates, because they may be (variously)
multidimensional or non-monotonic.</p>
</dd>
</dl>
<p>See an example printout of a hybrid height cube,
<a class="reference internal" href="../userguide/iris_cubes.html#hybrid-cube-printout"><span class="std std-ref">here</span></a>:</p>
<blockquote>
<div><p>Notice that this contains all of the above coordinates –
‘model_level_number’, ‘sigma’, ‘level_height’ and the derived ‘altitude’.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hybrid pressure levels can also be handled (for LBVC=9).  Without going
into details, the mechanism is very similar to that for hybrid height:
it produces basic coordinates ‘model_level_number’, ‘sigma’ and
‘level_pressure’, and a manufactured 3D ‘air_pressure’ coordinate.</p>
</div>
</div>
<div class="section" id="time-information">
<span id="um-time-metadata"></span><h2>Time information<a class="headerlink" href="#time-information" title="Permalink to this headline">¶</a></h2>
<p><strong>UM Field elements</strong></p>
<ul class="simple">
<li><p>“T1” (i.e. LBYR, LBMON, LBDAT, LBHR, LBMIN, LBDAY/LBSEC),</p></li>
<li><p>“T2” (i.e. LBYRD, LBMOND, LBDATD, LBHRD, LBMIND, LBDAYD/LBSECD),</p></li>
<li><p>LBTIM, LBFT</p></li>
</ul>
<dl class="simple">
<dt><strong>Cube components</strong></dt><dd><p>coordinates <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">forecast_reference_time</span></code>, <code class="docutils literal notranslate"><span class="pre">forecast_period</span></code></p>
</dd>
</dl>
<p><strong>Details</strong></p>
<p>In Iris (as in CF) times and time intervals are both expressed as simple
numbers, following the approach of the
<a class="reference external" href="http://www.unidata.ucar.edu/software/udunits/">UDUNITS project</a>.
These values are stored as cube coordinates, where the scaling and calendar
information is contained in the <a class="reference internal" href="../generated/api/iris/coords.html#iris.coords.Coord.units" title="iris.coords.Coord.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> property.</p>
<ul class="simple">
<li><p>The units of a time interval (e.g. ‘forecast_period’), can be ‘seconds’ or
a simple derived unit such as ‘hours’ or ‘days’ – but it does not contain
a calendar, so ‘months’ or ‘years’ are not valid.</p></li>
<li><p>The units of calendar-based times (including ‘time’ and
‘forecast_reference_time’), are of the general form
“&lt;time-unit&gt; since &lt;base-date&gt;”, interpreted according to the unit’s
<code class="xref py py-attr docutils literal notranslate"><span class="pre">calendar</span></code> property.  The base date for this is
always 1st Jan 1970 (times before this are represented as negative values).</p></li>
</ul>
<p>The units.calendar property of time coordinates is set from the lowest decimal
digit of LBTIM, known as LBTIM.IC.  Note that the non-gregorian calendars (e.g.
360-day ‘model’ calendar) are defined in CF, not udunits.</p>
<p>There are a number of different time encoding methods used in UM data, but the
important distinctions are controlled by the next-to-lowest decimal digit of
LBTIM, known as “LBTIM.IB”.
The most common cases are as follows:</p>
<dl class="simple">
<dt>Data at a single measurement timepoint (LBTIM.IB=0):</dt><dd><p>A single <code class="docutils literal notranslate"><span class="pre">time</span></code> coordinate is created, with points taken from T1 values.
It has no bounds, units of ‘hours since 1970-01-01 00:00:00’ and a calendar
defined according to LBTIM.IC.</p>
</dd>
<dt>Values forecast from T2, valid at T1 (LBTIM.IB=1):</dt><dd><p>Coordinates <code class="docutils literal notranslate"><span class="pre">time`</span> <span class="pre">and</span> <span class="pre">``forecast_reference_time</span></code> are created from the T1
and T2 values, respectively.  These have no bounds, and units of
‘hours since 1970-01-01 00:00:00’, with the appropriate calendar.
A <code class="docutils literal notranslate"><span class="pre">forecast_period</span></code> coordinate is also created, with values T1-T2, no
bounds and units of ‘hours’.</p>
</dd>
<dt>Time mean values between T1 and T2 (LBTIM.IB=2):</dt><dd><p>The time coordinates <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">forecast_reference_times</span></code> and
<code class="docutils literal notranslate"><span class="pre">forecast_reference_time</span></code>, are all present, as in the previous case.
In this case, however, the ‘time’ and ‘forecast_period’ coordinates also
have associated bounds:  The ‘time’ bounds are from T1 to T2, and the
‘forecast_period’ bounds are from “LBFT - (T2-T1)” to “LBFT”.</p>
</dd>
</dl>
<p>Note that, in those more complex cases where the input defines all three of the
‘time’, ‘forecast_reference_time’ and ‘forecast_period’ values, any or all of
these may become dimensions of the resulting data cube.  This will depend on
the values actually present in the source fields for each of the elements.</p>
<p>See an example printout of a forecast data cube,
<a class="reference internal" href="../userguide/cube_statistics.html#cube-statistics-forecast-printout"><span class="std std-ref">here</span></a> :</p>
<blockquote>
<div><p>Notice that this example contains all of the above coordinates – ‘time’,
‘forecast_period’ and ‘forecast_reference_time’.  In this case the data are
forecasts, so ‘time’ is a dimension, ‘forecast_period’ varies with time and
‘forecast_reference_time’ is a constant.</p>
</div></blockquote>
</div>
<div class="section" id="statistical-measures">
<h2>Statistical measures<a class="headerlink" href="#statistical-measures" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><strong>UM Field elements</strong></dt><dd><p>LBPROC, LBTIM</p>
</dd>
<dt><strong>Cube components</strong></dt><dd><p><code class="docutils literal notranslate"><span class="pre">cube.cell_methods</span></code></p>
</dd>
</dl>
<p><strong>Details</strong></p>
<p>Where a field contains statistically processed data, Iris will add an
appropriate <a class="reference internal" href="../generated/api/iris/coords.html#iris.coords.CellMethod" title="iris.coords.CellMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">iris.coords.CellMethod</span></code></a> to the cube, representing the
aggregation operation which was performed.</p>
<p>This is implemented for certain binary flag bits within the LBPROC element
value.  For example:</p>
<ul class="simple">
<li><dl class="simple">
<dt>time mean, when (LBPROC &amp; 128):</dt><dd><p>Cube has a cell_method of the form “CellMethod(‘mean’, ‘time’).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>time period minimum value, when (LBPROC &amp; 4096):</dt><dd><p>Cube has a cell_method of the form “CellMethod(‘minimum’, ‘time’).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>time period maximum value, when (LBPROC &amp; 8192):</dt><dd><p>Cube has a cell_method of the form “CellMethod(‘maximum’, ‘time’).</p>
</dd>
</dl>
</li>
</ul>
<p>In all these cases, if the field LBTIM is also set to denote a time aggregate
field (i.e. “LBTIM.IB=2”, see above <a class="reference internal" href="#um-time-metadata"><span class="std std-ref">Time information</span></a>), then the
second-to-last digit of LBTIM, aka “LBTIM.IA” may also be non-zero, in which
case this indicates the aggregation time-interval.  In that case, the
cell-method <a class="reference internal" href="../generated/api/iris/coords.html#iris.coords.CellMethod.intervals" title="iris.coords.CellMethod.intervals"><code class="xref py py-attr docutils literal notranslate"><span class="pre">intervals</span></code></a> attribute is also set to
this many hours.</p>
<dl>
<dt>For example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Show stats metadata in a test PP field.</span>
<span class="gp">... </span><span class="n">fname</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;pre-industrial.pp&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eg_field</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">eg_field</span><span class="o">.</span><span class="n">lbtim</span><span class="p">)</span>
<span class="go">622</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">eg_field</span><span class="o">.</span><span class="n">lbproc</span><span class="p">)</span>
<span class="go">128</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Print out the Iris equivalent information.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">load_cube</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">)</span>
<span class="go">(CellMethod(method=&#39;mean&#39;, coord_names=(&#39;time&#39;,), intervals=(&#39;6 hour&#39;,), comments=()),)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="other-metadata">
<h2>Other metadata<a class="headerlink" href="#other-metadata" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lbrsvd4">
<h3>LBRSVD4<a class="headerlink" href="#lbrsvd4" title="Permalink to this headline">¶</a></h3>
<p>If non-zero, this is interpreted as an ensemble number.  This produces a cube
scalar coordinate named ‘realization’ (as defined in the CF conventions).</p>
</div>
<div class="section" id="lbuser5">
<h3>LBUSER5<a class="headerlink" href="#lbuser5" title="Permalink to this headline">¶</a></h3>
<p>If non-zero, this is interpreted as a ‘pseudo_level’ number.  This produces a
cube scalar coordinate named ‘pseudo_level’.  In the UM documentation LBUSER5 is also sometimes referred to as LBPLEV.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="missing_data_handling.html" class="btn btn-neutral float-right" title="Missing data handling in Iris" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Iris technical papers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        
        &copy; <a href="../copyright.html">Copyright</a> Iris Contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>